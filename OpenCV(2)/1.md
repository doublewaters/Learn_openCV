## 3.图像阈值


*目标*
* 本节你将学到简单阈值，自适应阈值，Otsu’s 二值化等
* 将要学习的函数有 cv2.threshold，cv2.adaptiveThreshold 等。
---

### 3.1 简单阈值

与名字一样，这种方法非常简单。但像素值高于阈值时，我们给这个像素 赋予一个新值（可能是白色），否则我们给它赋予另外一种颜色（也许是黑色）。 这个函数就是 cv2.threshhold()。这个函数的第一个参数就是原图像，原图 像应该是灰度图。第二个参数就是用来对像素值进行分类的阈值。第三个参数就是当像素值高于（有时是小于）阈值时应该被赋予的新的像素值。OpenCV 提供了多种不同的阈值方法，这是有第四个参数来决定的。这些方法包括：
* cv2.THRESH_BINARY 
* cv2.THRESH_BINARY_INV 
* cv2.THRESH_TRUNC 
* cv2.THRESH_TOZERO 
* cv2.THRESH_TOZERO_INV

这个函数有两个返回值，第一个为 retVal，我们后面会解释。第二个就是 阈值化之后的结果图像了。
代码：

```
import cv2 
import numpy as np 
from matplotlib import pyplot as plt

img=cv2.imread('gradient.png',0)
ret,thresh1=cv2.threshold(img,127,255,cv2.THRESH_BINARY) 
ret,thresh2=cv2.threshold(img,127,255,cv2.THRESH_BINARY_INV) 
ret,thresh3=cv2.threshold(img,127,255,cv2.THRESH_TRUNC) 
ret,thresh4=cv2.threshold(img,127,255,cv2.THRESH_TOZERO) 
ret,thresh5=cv2.threshold(img,127,255,cv2.THRESH_TOZERO_INV)
titles = ['Original Image','BINARY','BINARY_INV','TRUNC','TOZERO','TOZERO_INV']
images = [img, thresh1, thresh2, thresh3, thresh4, thresh5]
for i in range(6): 
    plt.subplot(2,3,i+1),plt.imshow(images[i],'gray') 
    plt.title(titles[i]) 
    plt.xticks([]),plt.yticks([])
plt.show()
```

![](1.png )

### 3.2 自适应阈值

在前面的部分我们使用是全局阈值，整幅图像采用同一个数作为阈值。当时这种方法并不适应与所有情况，尤其是当同一幅图像上的不同部分的具有不同亮度时。这种情况下我们需要采用自适应阈值。此时的阈值是根据图像上 每一个小区域计算与其对应的阈值。因此在同一幅图像上的不同区域采用的是不同的阈值，从而使我们能在亮度不同的情况下得到更好的结果。 

这种方法需要我们指定三个参数，返回值只有一个。 

* Adaptive Method- 指定计算阈值的方法。 
    *  cv2.ADPTIVE_THRESH_MEAN_C：阈值取自相邻区域的平均值 
    *  cv2.ADPTIVE_THRESH_GAUSSIAN_C：阈值取值相邻区域的加权和，权重为一个高斯窗口。
* Block Size - 邻域大小（用来计算阈值的区域大小）。 
*  C - 这就是是一个常数，阈值就等于的平均值或者加权平均值减去这个常数。

我们使用下面的代码来展示简单阈值与自适应阈值的差别：

```
import cv2 
import numpy as np 
from matplotlib import pyplot as plt
img = cv2.imread('2.png',0) 
# 中值滤波 img = cv2.medianBlur(img,5)
ret,th1 = cv2.threshold(img,127,255,cv2.THRESH_BINARY) 
#11 为 Block size, 2 为 C 值 
th2 = cv2.adaptiveThreshold(img,255,cv2.ADAPTIVE_THRESH_MEAN_C,cv2.THRESH_BINARY,11,2) 
th3 = cv2.adaptiveThreshold(img,255,cv2.ADAPTIVE_THRESH_GAUSSIAN_C,cv2.THRESH_BINARY,11,2)
titles = ['Original Image', 'Global Thresholding (v = 127)', 'Adaptive Mean Thresholding', 'Adaptive Gaussian Thresholding'] 
images = [img, th1, th2, th3]
for i in range(4): 
    plt.subplot(2,2,i+1),plt.imshow(images[i],'gray') 
    plt.title(titles[i]) 
    plt.xticks([]),plt.yticks([]) 
plt.show()
```

![](3.png)
![](../OpenCV图像处理/1.jpg)